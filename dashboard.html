<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8" />
    <title>Dizzi - Votação em Tempo Real</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100 font-sans">

    <!-- Header -->
    <header class="bg-gray-900 text-white sticky top-0 z-50 shadow-md">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <!-- Logo -->
                <div class="text-2xl font-bold text-cyan-400">
                    Dizzi
                </div>

                <!-- Desktop Menu -->
                <nav class="hidden md:flex space-x-8">
                    <a href="#" class="hover:text-cyan-400 transition">Início</a>
                    <a href="#" class="hover:text-cyan-400 transition">Sobre</a>
                    <a href="#" class="hover:text-cyan-400 transition">Serviços</a>
                    <a href="#" class="hover:text-cyan-400 transition">Portfólio</a>
                    <a href="#" class="hover:text-cyan-400 transition">Contato</a>
                </nav>

                <!-- Mobile Button -->
                <div class="md:hidden">
                    <button id="menu-toggle" class="text-2xl focus:outline-none">
                        ☰
                    </button>
                </div>
            </div>
        </div>

        <!-- Mobile Menu -->
        <div id="mobile-menu" class="md:hidden hidden px-4 pb-4 bg-gray-900">
            <a href="#" class="block py-2 text-white hover:text-cyan-400">Início</a>
            <a href="#" class="block py-2 text-white hover:text-cyan-400">Sobre</a>
            <a href="#" class="block py-2 text-white hover:text-cyan-400">Serviços</a>
            <a href="#" class="block py-2 text-white hover:text-cyan-400">Portfólio</a>
            <a href="#" class="block py-2 text-white hover:text-cyan-400">Contato</a>
        </div>
    </header>

    <!-- Conteúdo -->
    <main class="max-w-4xl mx-auto p-6">
        <!-- Título da Votação -->
        <h1 id="pollTitle" class="text-3xl font-bold text-gray-800 mb-6 text-center">
            Carregando eleição...
        </h1>

        <!-- Total de votos -->
        <section class="bg-white rounded-lg shadow p-6 mb-6">
            <h2 class="text-xl font-semibold text-gray-800 mb-2">Total de Votos</h2>
            <p class="text-3xl font-bold text-blue-600" id="totalVotes">0</p>
        </section>

        <!-- Códigos Ativos -->
        <section class="bg-white rounded-lg shadow p-6 mb-6">
            <h2 class="text-xl font-semibold text-gray-800 mb-2">Código Ativo</h2>
            <ul id="codes" class="list-disc ml-6 text-gray-700"></ul>
        </section>

        <!-- Opções de Votação -->
        <section class="bg-white rounded-lg shadow p-6 mb-6">
            <h2 class="text-xl font-semibold text-gray-800 mb-2">Opções de Votação</h2>
            <ul id="options" class="list-disc ml-6 text-gray-700"></ul>
        </section>

        <!-- Usuários que Votaram -->
        <section class="bg-white rounded-lg shadow p-6 mb-6">
            <h2 class="text-xl font-semibold text-gray-800 mb-2">Usuários que Votaram</h2>
            <ul id="votedUsers" class="list-disc ml-6 text-gray-700"></ul>
        </section>

        <!-- Timestamp -->
        <div class="flex items-center justify-center text-sm text-gray-500 mt-4" id="timestamp">
            <div class="w-4 h-4 border-2 border-gray-300 border-t-cyan-500 rounded-full animate-spin mr-2"></div>
            <span id="timestamp-text">Última atualização: --</span>
        </div>

    </main>

    <!-- Script -->
    <script>
        const pollTitleEl = document.getElementById('pollTitle');
        const totalVotesEl = document.getElementById('totalVotes');
        const codesEl = document.getElementById('codes');
        const optionsEl = document.getElementById('options');
        const votedUsersEl = document.getElementById('votedUsers');
        const timestampEl = document.getElementById('timestamp');
        const toggleBtn = document.getElementById('menu-toggle');
        const mobileMenu = document.getElementById('mobile-menu');

        const urlParams = new URLSearchParams(window.location.search);
        const id = urlParams.get('poll_id');
        if (id) {
            console.log("Aqui o ID vindo de profile: " + id);
        }

        // Toggle do menu mobile
        toggleBtn.addEventListener('click', () => {
            mobileMenu.classList.toggle('hidden');
        });

        // Conexão com SSE
        const evtSource = new EventSource(`php.php?poll_id=${id}`); // seu endpoint SSE

        evtSource.onmessage = function (event) {
            const data = JSON.parse(event.data);

            if (data.error) {
                pollTitleEl.textContent = "Erro: " + data.error;
                return;
            }

            // Atualiza dados
            pollTitleEl.textContent = data.poll_title;
            totalVotesEl.textContent = data.total_votes;

            // Atualiza listas
            updateList(codesEl, data.codes);
            updateList(optionsEl, data.options);
            updateList(votedUsersEl, data.voted_users);

            // Timestamp
            timestampEl.querySelector("#timestamp-text").textContent = "Última atualização: " + data.timestamp;

        };

        evtSource.onerror = function (err) {
            console.error("Erro SSE:", err);
        };

        // Função utilitária para atualizar listas
        function updateList(container, items) {
            container.innerHTML = '';
            items.forEach(item => {
                const li = document.createElement('li');
                li.textContent = item;
                container.appendChild(li);
            });
        }
    </script>

</body>

</html>