<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <title>Dizzi - Login</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="font-sans flex justify-center items-center min-h-screen bg-[#eef2f7]">
  <div class="bg-white p-8 rounded-xl shadow-lg w-80 text-center">
    <h2 class="text-2xl font-semibold mb-6">Login</h2>
    <form id="loginForm" class="flex flex-col gap-3 text-left">
      <div class="flex flex-col gap-1">
        <input type="text" id="user_name" placeholder="Nome de usuário" required
          class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-green-400" />
      </div>
      <div class="flex flex-col gap-1">
        <input type="password" id="password" placeholder="Senha" required
          class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-green-400" />
      </div>
      <button type="submit"
        class="w-full py-2 mt-2 bg-green-600 text-white rounded hover:bg-green-700 transition-colors">Entrar</button>
    </form>
    <a href="register.html" class="block mt-4 text-gray-700 hover:underline">Não tem conta? Registre-se</a>
    <a href="index.html" class="block mt-2 text-gray-700 hover:underline">Voltar</a>
  </div>

  <script>
    window.addEventListener("pageshow", async function (event) {
      // Payload arbitrário para teste
      const payload = {
        action: "login",
        username: "usuario_teste",
        password: "senha_teste"
      };

      try {
        const response = await fetch("https://localhost/app/Routes/api.php", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          credentials: "include",
          body: JSON.stringify(payload)
        });

        const result = await response.json();
        console.log(result);

        if (result.success) {
          window.location.href = "profile.html";
        }

      } catch (error) {
        console.error("Erro na requisição:", error);
      }
    });

    document.getElementById("loginForm").addEventListener("submit", async function (event) {
      event.preventDefault();

      const user_name = document.getElementById("user_name").value;
      const password = document.getElementById("password").value;

      // JSON no padrão que você pediu
      const payload = {
        action: "login",
        user_name: user_name,
        password: password
      };

      try {
        const response = await fetch("https://localhost/app/Routes/api.php", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify(payload)
        });

        const result = await response.json();
        console.log(result);

        if (result.success) {
          alert("Login realizado com sucesso!");
          window.location.href = "profile.html"; // <- ajuste conforme sua aplicação
        } else {
          alert("Erro: " + (result.message || "Credenciais inválidas."));
        }
      } catch (error) {
        console.error("Erro na requisição:", error);
        alert("Erro na conexão com o servidor.");
      }
    });

  </script>
</body>

</html>
